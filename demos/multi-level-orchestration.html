<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Level Agent Orchestration ‚Äî Live Demo | AfrexAI</title>
    <meta name="description" content="Watch a wide fractal agent swarm spawn, communicate, and execute tasks in real-time. Kael orchestrates CC instances, task agents, and workers via markdown files.">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html, body, #root { height: 100%; width: 100%; overflow: hidden; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
const { useState, useEffect, useCallback, useRef } = React;

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   AFAF COMMAND CENTER ‚Äî WIDE Fractal Tree
   
   HORIZONTAL architecture ‚Äî each node spawns 3-9 children:
   
   KAEL ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ CC::VADIS ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ Deploy ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ docker-build
          ‚îÇ               ‚îÇ            ‚îú‚îÄ‚îÄ dns-config  
          ‚îÇ               ‚îÇ            ‚îú‚îÄ‚îÄ smoke-test
          ‚îÇ               ‚îÇ            ‚îî‚îÄ‚îÄ ssl-renew
          ‚îÇ               ‚îú‚îÄ‚îÄ Monitor ‚îÄ‚î¨‚îÄ‚îÄ health-ping
          ‚îÇ               ‚îÇ            ‚îú‚îÄ‚îÄ uptime-check
          ‚îÇ               ‚îÇ            ‚îî‚îÄ‚îÄ alert-dispatch
          ‚îÇ               ‚îú‚îÄ‚îÄ Sync ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ crm-push
          ‚îÇ               ‚îÇ            ‚îî‚îÄ‚îÄ data-merge
          ‚îÇ               ‚îî‚îÄ‚îÄ Support ‚îÄ‚î¨‚îÄ‚îÄ ticket-route
          ‚îÇ                            ‚îî‚îÄ‚îÄ email-send
          ‚îú‚îÄ‚îÄ CC::KIN ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ ...
          ‚îú‚îÄ‚îÄ CC::SiteVoice‚î¨‚îÄ‚îÄ ...
          ‚îî‚îÄ‚îÄ CC::RapidShift‚î¨‚îÄ‚îÄ ...
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

const mono = "'JetBrains Mono','Fira Code','SF Mono',monospace";
const C = {
  bg:"#06060c",panel:"#0c0c18",card:"#10101e",
  border:"#1a1a32",text:"#d0d0e4",dim:"#5e5e80",muted:"#2e2e4a",
  green:"#22c55e",blue:"#3b82f6",amber:"#eab308",
  red:"#ef4444",purple:"#a855f7",cyan:"#06b6d4",pink:"#ec4899",
};

const TIER = {
  0:{ label:"ORCHESTRATOR", color:C.cyan,  icon:"üëÅ", max:4 },
  1:{ label:"CLAUDE CODE",  color:C.purple,icon:"‚ö°", max:9 },
  2:{ label:"TASK AGENT",   color:C.green, icon:"üß¨", max:9 },
  3:{ label:"WORKER",       color:C.amber, icon:"‚öô",  max:0 },
};

const TEMPLATES = {
  0:[
    { name:"CC::VADIS",     role:"VADIS veteran services" },
    { name:"CC::KIN",       role:"KIN Living property mgmt" },
    { name:"CC::SiteVoice", role:"SiteVoice AI receptionist" },
    { name:"CC::RapidShift",role:"RapidShift logistics" },
  ],
  1:[
    { name:"Deploy",   role:"Clone ‚Üí Build ‚Üí Ship" },
    { name:"Monitor",  role:"Health + uptime" },
    { name:"Sync",     role:"CRM + data pipes" },
    { name:"Support",  role:"Tickets + comms" },
    { name:"Backup",   role:"Snapshot + restore" },
    { name:"Security", role:"Audit + certs" },
    { name:"Analytics",role:"Metrics + reports" },
    { name:"Cache",    role:"CDN + TTS warm" },
    { name:"Migrate",  role:"DB schema ops" },
  ],
  2:[
    { name:"docker-build",  role:"Build image" },
    { name:"dns-config",    role:"Cloudflare records" },
    { name:"smoke-test",    role:"Hit /health" },
    { name:"ssl-renew",     role:"Rotate certs" },
    { name:"crm-push",      role:"Sync records" },
    { name:"email-send",    role:"Notify client" },
    { name:"db-migrate",    role:"Run migrations" },
    { name:"backup-snap",   role:"Compress + upload" },
    { name:"cache-warm",    role:"Prime CDN" },
    { name:"log-rotate",    role:"Archive logs" },
    { name:"health-ping",   role:"Endpoint check" },
    { name:"uptime-check",  role:"Track SLA" },
    { name:"alert-dispatch",role:"Send alerts" },
    { name:"data-merge",    role:"Deduplicate" },
    { name:"metric-agg",    role:"Aggregate stats" },
    { name:"ticket-route",  role:"Triage tickets" },
    { name:"schema-diff",   role:"Compare schemas" },
    { name:"asset-optimize",role:"Compress images" },
    { name:"secret-rotate", role:"Rotate API keys" },
  ],
};

const TASKS=["Clone BRAND_CONFIG","Build Docker image","Provision Hetzner CX31","Config Cloudflare","Smoke test /health","Sync CRM records","Rotate SSL","DB migrate v3.2‚Üív3.3","Warm TTS cache","Deploy confirmation email","Backup to S3","Verify DNS propagation","Update MODULE_REGISTRY","Lead scoring run","Generate case study","Compress assets","Audit open ports","Schema diff check","Triage new ticket"];
const STATUSES=["Layer 14/22 deps","All 200 OK","Waiting upstream","47/52 records","DNS 3/4 regions","Build cached 340MB","12/12 pass","Cert 89d left","Listening webhooks","Idle","Optimizing","Processing batch"];
const RESULTS=["‚úì Live at client.afrexai.com","‚úì 0 failures/24h","‚úì 47 synced 0 conflicts","‚úì Image sha256:a8f3‚Ä¶","‚úì DNS TTL 300s","‚úì p99 42ms","‚úì 12 hot 31 warm","‚úì 2.4GB‚Üí680MB","‚úì SSL exp 2027","‚úì 0 rollbacks","‚úì Cache 3.2s‚Üí180ms","‚úì Tickets triaged","‚úì Schema clean","‚úì Assets -62%"];

let _id=0;
const uid=()=>`a-${++_id}`;
const ts=()=>{const d=new Date();return`${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")}:${String(d.getSeconds()).padStart(2,"0")}.${String(d.getMilliseconds()).padStart(3,"0").slice(0,2)}`;};
const pick=a=>a[Math.floor(Math.random()*a.length)];
const mkFile={
  spawn:(p,c)=>`# SPAWN.md
**From:** ${p} ‚Üí ${c}
**Time:** ${ts()}`,
  task:(f,t)=>`# TASK.md
**Assigned:** ${f}
**Task:** ${t}
**Time:** ${ts()}`,
  result:(n,m)=>`# RESULT.md
**Agent:** ${n}
**Result:** ${m}
**Time:** ${ts()}`,
  status:(n,m)=>`# STATUS.md
**Agent:** ${n}
${m}
**Time:** ${ts()}`,
};
const INIT=()=>{_id=0;return[{id:uid(),name:"Kael",tier:0,status:"running",parent:null,folder:"/agents/kael",children:[],files:[]}];};

function App(){
  const [agents,setAgents]=useState(INIT);
  const [logs,setLogs]=useState([{time:ts(),type:"system",agent:"Kael",msg:"Online. Hit RUN to spawn swarm."}]);
  const [sel,setSel]=useState(null);
  const [preview,setPreview]=useState(null);
  const [on,setOn]=useState(false);
  const [speed,setSpeed]=useState(100);
  const [stats,setStats]=useState({agents:1,files:0,msgs:0,depth:0,wide:0});
  const logEnd=useRef(null);
  const iv=useRef(null);

  const log=useCallback((type,agent,msg)=>{
    setLogs(p=>[...p.slice(-200),{time:ts(),type,agent,msg}]);
    setStats(p=>({...p,msgs:p.msgs+1}));
  },[]);

  const writeFile=useCallback((aid,name,content)=>{
    setAgents(p=>p.map(a=>a.id===aid?{...a,files:[...a.files.slice(-8),{name,content,time:ts()}]}:a));
    setStats(p=>({...p,files:p.files+1}));
  },[]);

  const spawn=useCallback((pid)=>{
    setAgents(prev=>{
      const par=prev.find(a=>a.id===pid);
      if(!par||par.tier>=3)return prev;
      const mx=TIER[par.tier].max;
      if(par.children.length>=mx)return prev;
      const tmpls=TEMPLATES[par.tier];
      const used=par.children.map(c=>prev.find(a=>a.id===c)?.name).filter(Boolean);
      const avail=tmpls.filter(t=>!used.includes(t.name));
      if(!avail.length)return prev;
      const t=pick(avail);
      const cid=uid();
      const folder=`${par.folder}/${t.name.toLowerCase().replace(/[^a-z0-9]/g,"-")}`;
      const child={id:cid,name:t.name,tier:par.tier+1,status:"running",parent:pid,folder,children:[],files:[]};
      writeFile(cid,"SPAWN.md",mkFile.spawn(par.name,child.name));
      log("spawn",par.name,`‚Ü≥ ${child.name} ‚Äî ${t.role}`);
      setStats(p=>({...p,agents:p.agents+1}));
      return[...prev.map(a=>a.id===pid?{...a,children:[...a.children,cid]}:a),child];
    });
  },[log,writeFile]);

  const tick=useCallback(()=>{
    setAgents(prev=>{
      const alive=prev.filter(a=>a.status==="running");
      if(!alive.length)return prev;
      const ag=pick(alive);
      const r=Math.random();
      if(r<0.35&&ag.tier<3&&ag.children.length<TIER[ag.tier].max){
        setTimeout(()=>spawn(ag.id),0);
      }else if(r<0.55){
        const kids=prev.filter(a=>a.parent===ag.id&&a.status==="running");
        if(kids.length){const k=pick(kids);const t=pick(TASKS);writeFile(k.id,"TASK.md",mkFile.task(ag.name,t));log("task",ag.name,`‚Üí ${k.name}: ${t}`);}
      }else if(r<0.75){
        const par=prev.find(a=>a.id===ag.parent);
        if(par){const res=pick(RESULTS);writeFile(ag.id,"RESULT.md",mkFile.result(ag.name,res));log("result",ag.name,`‚Üë ${par.name}: ${res}`);}
      }else if(r<0.9){
        const m=pick(STATUSES);writeFile(ag.id,"STATUS.md",mkFile.status(ag.name,m));log("status",ag.name,m);
      }else{
        log("heartbeat",ag.name,`‚ô• ${Math.floor(Math.random()*256)+64}MB`);
      }
      return prev;
    });
  },[spawn,log,writeFile]);

  useEffect(()=>{if(on){iv.current=setInterval(tick,speed);}else clearInterval(iv.current);return()=>clearInterval(iv.current);},[on,speed,tick]);
  useEffect(()=>{logEnd.current?.scrollIntoView({behavior:"auto"});},[logs]);
  useEffect(()=>{
    const d=(id,all)=>{const ch=all.filter(a=>a.parent===id);return ch.length?1+Math.max(...ch.map(c=>d(c.id,all))):0;};
    const w=(id,all)=>{const ch=all.filter(a=>a.parent===id);return ch.length?Math.max(ch.length,...ch.map(c=>w(c.id,all))):0;};
    const root=agents.find(a=>!a.parent);
    if(root)setStats(p=>({...p,depth:d(root.id,agents),wide:w(root.id,agents)}));
  },[agents]);

  const reset=()=>{setAgents(INIT());setLogs([{time:ts(),type:"system",agent:"Kael",msg:"Reset."}]);setStats({agents:1,files:0,msgs:0,depth:0,wide:0});setSel(null);setPreview(null);setOn(false);};
  const sa=agents.find(a=>a.id===sel);
  const lc={system:C.cyan,spawn:C.purple,task:C.blue,result:C.green,status:C.dim,heartbeat:C.muted,info:C.blue};
  const li={system:"‚óÜ",spawn:"+",task:"‚Üí",result:"‚Üë",status:"¬∑",heartbeat:"‚ô•",info:"‚Ñπ"};

  // Build tree
  const buildTree=(id,all)=>{const n=all.find(a=>a.id===id);if(!n)return null;return{...n,kids:all.filter(a=>a.parent===id).map(c=>buildTree(c.id,all)).filter(Boolean)};};
  const root=agents.find(a=>!a.parent);
  const tree=root?buildTree(root.id,agents):null;

  return(
    <div style={{background:C.bg,color:C.text,fontFamily:mono,fontSize:11,height:"100vh",display:"flex",flexDirection:"column",overflow:"hidden"}}>
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap');
        *{box-sizing:border-box;margin:0;padding:0}
        ::-webkit-scrollbar{width:3px;height:3px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:${C.muted};border-radius:2px}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.35}}
        @keyframes pop{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}
      `}</style>

      {/* HEADER */}
      <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"6px 14px",borderBottom:`1px solid ${C.border}`,background:C.panel,flexShrink:0}}>
        <div style={{display:"flex",alignItems:"center",gap:8}}>
          <span style={{fontSize:16}}>üå≥</span>
          <div>
            <div style={{fontSize:12,fontWeight:700}}>AFAF <span style={{color:C.cyan}}>SWARM</span></div>
            <div style={{fontSize:7,color:C.dim,letterSpacing:"1.5px"}}>WIDE FRACTAL ¬∑ KAEL ‚Üí CC ‚Üí TASKS ‚Üí WORKERS</div>
          </div>
        </div>
        <div style={{display:"flex",alignItems:"center",gap:10}}>
          {[
            {l:"AGENTS",v:stats.agents,c:C.purple},
            {l:"WIDTH",v:stats.wide,c:C.pink},
            {l:"DEPTH",v:stats.depth,c:C.cyan},
            {l:"FILES",v:stats.files,c:C.green},
            {l:"I/O",v:stats.msgs,c:C.blue},
          ].map(s=>(
            <div key={s.l} style={{textAlign:"center",minWidth:34}}>
              <div style={{fontSize:13,fontWeight:700,color:s.c}}>{s.v}</div>
              <div style={{fontSize:6,color:C.dim,letterSpacing:"1px"}}>{s.l}</div>
            </div>
          ))}
          <div style={{width:1,height:22,background:C.border}}/>
          <button onClick={()=>setSpeed(s=>Math.max(20,Math.round(s/2)))} style={btn}>‚ö°</button>
          <span style={{fontSize:8,color:C.muted,minWidth:36,textAlign:"center"}}>{speed}ms</span>
          <button onClick={()=>setSpeed(s=>Math.min(2000,s*2))} style={btn}>üêå</button>
          <div style={{width:1,height:22,background:C.border}}/>
          <button onClick={()=>setOn(!on)} style={{...btn,color:on?C.red:C.green,borderColor:on?`${C.red}40`:`${C.green}40`,background:on?`${C.red}12`:`${C.green}12`,padding:"3px 12px",fontWeight:700,letterSpacing:"1px",fontSize:11}}>
            {on?"‚ñ† STOP":"‚ñ∂ RUN"}
          </button>
          <button onClick={reset} style={btn}>‚Ü∫</button>
        </div>
      </div>

      {/* MAIN */}
      <div style={{flex:1,display:"grid",gridTemplateColumns:"1fr 280px",gridTemplateRows:"auto 1fr",overflow:"hidden"}}>

        {/* TOP ‚Äî HORIZONTAL TREE MAP */}
        <div style={{gridColumn:"1/3",borderBottom:`1px solid ${C.border}`,overflow:"auto",padding:"8px 12px",maxHeight:"45vh",minHeight:120,background:`${C.panel}80`}}>
          {tree&&<HTree node={tree} sel={sel} onSel={setSel} onSpawn={spawn} isRoot/>}
        </div>

        {/* BOTTOM LEFT ‚Äî LOG */}
        <div style={{display:"flex",flexDirection:"column",overflow:"hidden"}}>
          <div style={{padding:"4px 10px",borderBottom:`1px solid ${C.border}`,display:"flex",justifyContent:"space-between",flexShrink:0}}>
            <span style={{fontSize:7,fontWeight:700,letterSpacing:"2px",color:C.dim}}>LIVE I/O</span>
            <div style={{display:"flex",gap:6}}>
              {["spawn","task","result","status"].map(t=>(
                <span key={t} style={{fontSize:6,color:lc[t]}}>‚óè {t.toUpperCase()}</span>
              ))}
            </div>
          </div>
          <div style={{flex:1,overflow:"auto",padding:"1px 6px"}}>
            {logs.map((l,i)=>(
              <div key={i} style={{display:"flex",gap:4,padding:"1px 0",opacity:i<logs.length-60?.15:1,fontSize:9,lineHeight:1.4}}>
                <span style={{color:C.muted,minWidth:62,flexShrink:0}}>{l.time}</span>
                <span style={{color:lc[l.type]||C.dim,minWidth:7}}>{li[l.type]||"¬∑"}</span>
                <span style={{color:TIER[agents.find(a=>a.name===l.agent)?.tier]?.color||C.cyan,minWidth:70,fontWeight:600,flexShrink:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{l.agent}</span>
                <span style={{color:`${C.text}cc`,flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{l.msg}</span>
              </div>
            ))}
            <div ref={logEnd}/>
          </div>
          {preview&&(
            <div style={{borderTop:`1px solid ${C.border}`,background:C.panel,maxHeight:100,overflow:"auto",padding:6,flexShrink:0}}>
              <div style={{display:"flex",justifyContent:"space-between",marginBottom:3}}>
                <span style={{fontSize:9,color:C.cyan,fontWeight:600}}>üìÑ {preview.name}</span>
                <span onClick={()=>setPreview(null)} style={{color:C.dim,cursor:"pointer",fontSize:9}}>‚úï</span>
              </div>
              <pre style={{fontSize:9,color:C.text,whiteSpace:"pre-wrap",lineHeight:1.3,opacity:.8}}>{preview.content}</pre>
            </div>
          )}
        </div>

        {/* BOTTOM RIGHT ‚Äî INSPECTOR */}
        <div style={{borderLeft:`1px solid ${C.border}`,display:"flex",flexDirection:"column",overflow:"hidden"}}>
          <div style={{padding:"4px 10px",borderBottom:`1px solid ${C.border}`,fontSize:7,fontWeight:700,letterSpacing:"2px",color:C.dim,flexShrink:0}}>
            {sa?"INSPECTOR":"SELECT AGENT"}
          </div>
          {sa?(
            <div style={{flex:1,overflow:"auto",padding:8}}>
              <div style={{display:"flex",alignItems:"center",gap:6,marginBottom:8}}>
                <span style={{fontSize:18}}>{TIER[sa.tier].icon}</span>
                <div>
                  <div style={{fontSize:13,fontWeight:700,color:TIER[sa.tier].color}}>{sa.name}</div>
                  <div style={{fontSize:7,color:C.dim,letterSpacing:"1px"}}>{TIER[sa.tier].label} ¬∑ L{sa.tier}</div>
                </div>
              </div>
              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:4,marginBottom:8}}>
                {[
                  {l:"STATUS",v:sa.status,c:sa.status==="running"?C.green:C.amber},
                  {l:"CHILDREN",v:sa.children.length,c:C.purple},
                  {l:"FILES",v:sa.files.length,c:C.blue},
                ].map(s=>(
                  <div key={s.l} style={{background:C.card,borderRadius:3,padding:"3px 5px",border:`1px solid ${C.border}`}}>
                    <div style={{fontSize:6,color:C.dim,letterSpacing:"1px"}}>{s.l}</div>
                    <div style={{fontSize:11,fontWeight:700,color:s.c}}>{s.v}</div>
                  </div>
                ))}
              </div>
              <div style={{background:`${C.cyan}08`,border:`1px solid ${C.cyan}12`,borderRadius:3,padding:"3px 6px",marginBottom:8,fontSize:8}}>
                <span style={{color:C.cyan}}>üìÅ</span> <span style={{color:C.text,wordBreak:"break-all"}}>{sa.folder}/</span>
              </div>
              {sa.children.length>0&&(
                <div style={{marginBottom:8}}>
                  <div style={{fontSize:7,fontWeight:700,color:C.dim,letterSpacing:"1px",marginBottom:3}}>CHILDREN</div>
                  <div style={{display:"flex",flexWrap:"wrap",gap:3}}>
                    {sa.children.map(cid=>{
                      const ch=agents.find(a=>a.id===cid);if(!ch)return null;
                      return <span key={cid} onClick={()=>setSel(cid)} style={{fontSize:8,padding:"1px 5px",borderRadius:2,cursor:"pointer",background:`${TIER[ch.tier].color}12`,color:TIER[ch.tier].color,border:`1px solid ${TIER[ch.tier].color}18`}}>{ch.name}</span>;
                    })}
                  </div>
                </div>
              )}
              <div style={{fontSize:7,fontWeight:700,color:C.dim,letterSpacing:"1px",marginBottom:3}}>FILES</div>
              {sa.files.length===0?<div style={{fontSize:8,color:C.muted}}>‚Äî</div>:
                sa.files.map((f,i)=>(
                  <div key={i} onClick={()=>setPreview(f)} style={{display:"flex",justifyContent:"space-between",padding:"2px 4px",borderRadius:2,cursor:"pointer",background:preview?.time===f.time&&preview?.name===f.name?`${C.blue}10`:"transparent"}}>
                    <span style={{fontSize:9,color:C.text}}>üìÑ {f.name}</span>
                    <span style={{fontSize:7,color:C.muted}}>{f.time}</span>
                  </div>
                ))
              }
              {sa.tier<3&&<button onClick={()=>spawn(sa.id)} style={{width:"100%",marginTop:8,padding:"4px 0",background:`${TIER[sa.tier+1].color}10`,border:`1px solid ${TIER[sa.tier+1].color}20`,borderRadius:3,color:TIER[sa.tier+1].color,fontSize:8,fontWeight:700,letterSpacing:"1px",cursor:"pointer",fontFamily:mono}}>+ SPAWN {TIER[sa.tier+1].label}</button>}
            </div>
          ):(
            <div style={{flex:1,display:"flex",alignItems:"center",justifyContent:"center",color:C.muted,fontSize:9}}>Click any node above</div>
          )}
        </div>
      </div>
    </div>
  );
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   HORIZONTAL TREE ‚Äî the key visual
   Each tier flows LEFT ‚Üí RIGHT
   Children stack VERTICALLY under parent
   Connectors show the hierarchy
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function HTree({node,sel,onSel,onSpawn,isRoot}){
  const t=TIER[node.tier];
  const active=sel===node.id;
  const hasKids=node.kids&&node.kids.length>0;

  return(
    <div style={{display:"flex",alignItems:"flex-start",gap:0}}>
      {/* THIS NODE */}
      <div style={{display:"flex",flexDirection:"column",alignItems:"center",flexShrink:0}}>
        <div
          onClick={()=>onSel(node.id)}
          onDoubleClick={()=>{if(node.tier<3)onSpawn(node.id);}}
          title={`${node.folder}\nDbl-click ‚Üí spawn`}
          style={{
            display:"flex",alignItems:"center",gap:4,
            padding:"3px 8px",borderRadius:4,cursor:"pointer",
            background:active?`${t.color}18`:C.card,
            border:`1px solid ${active?`${t.color}40`:C.border}`,
            boxShadow:active?`0 0 8px ${t.color}15`:"none",
            transition:"all .1s",
            animation:"pop .2s ease-out",
            whiteSpace:"nowrap",
            minWidth:isRoot?60:undefined,
          }}
        >
          <div style={{
            width:6,height:6,borderRadius:"50%",flexShrink:0,
            background:node.status==="running"?t.color:C.muted,
            boxShadow:node.status==="running"?`0 0 4px ${t.color}`:"none",
            animation:node.status==="running"?"pulse 1.5s infinite":"none",
          }}/>
          <span style={{fontSize:9,fontWeight:600,color:active?t.color:C.text}}>{node.name}</span>
          {node.files.length>0&&<span style={{fontSize:7,color:C.muted}}>üìÑ{node.files.length}</span>}
        </div>
      </div>

      {/* CHILDREN ‚Äî vertical stack with connector */}
      {hasKids&&(
        <div style={{display:"flex",alignItems:"flex-start"}}>
          {/* Horizontal line from parent ‚Üí children */}
          <div style={{width:12,display:"flex",flexDirection:"column",justifyContent:"center",alignSelf:"stretch",position:"relative"}}>
            <div style={{position:"absolute",left:0,top:"50%",width:12,height:1,background:`${t.color}30`}}/>
          </div>
          {/* Children column */}
          <div style={{display:"flex",flexDirection:"column",gap:2,position:"relative"}}>
            {/* Vertical connector line */}
            {node.kids.length>1&&(
              <div style={{position:"absolute",left:-1,top:10,bottom:10,width:1,background:`${TIER[Math.min(node.tier+1,3)].color}20`}}/>
            )}
            {node.kids.map((k,i)=>(
              <div key={k.id} style={{display:"flex",alignItems:"flex-start",position:"relative"}}>
                {/* Branch tick */}
                <div style={{width:8,height:1,background:`${TIER[Math.min(node.tier+1,3)].color}25`,marginTop:11,flexShrink:0}}/>
                <HTree node={k} sel={sel} onSel={onSel} onSpawn={onSpawn}/>
              </div>
            ))}
          </div>
        </div>
      )}
    </div>
  );
}

const btn={background:C.card,border:`1px solid ${C.border}`,borderRadius:3,color:C.dim,padding:"2px 6px",cursor:"pointer",fontSize:9,fontFamily:mono};

const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(<App />);
    </script>
</body>
</html>